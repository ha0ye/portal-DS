<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Parallelization • portalDS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Parallelization">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">portalDS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/maizuru-dynamic-stability.html">Compute Dynamic Stability for the Maizuru Bay Fish Community</a>
    </li>
    <li>
      <a href="../articles/parallelization.html">Parallelization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ha0ye/portalDS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Parallelization</h1>
                        <h4 class="author">Hao Ye</h4>
            
            <h4 class="date">2019-12-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ha0ye/portalDS/blob/master/vignettes/parallelization.Rmd"><code>vignettes/parallelization.Rmd</code></a></small>
      <div class="hidden name"><code>parallelization.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document discusses parallelization options for this package. Because the full analysis can involve many independent calculations (esp. at the step of identifying the pairwise interactions), taking advantage of the ability to run code in parallel can speed things up.</p>
<p>To facilitate different computer setups, we use the <code>future</code> package, which enables the user to define the parallelization setup.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(portalDS)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(drake)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">drake_make_menu =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">        <span class="dt">drake_clean_recovery_msg =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Setup the data and compute simplex results.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"block_3sp"</span>, <span class="dt">package =</span> <span class="st">"rEDM"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">block &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/setNames">setNames</a></span>(block_3sp[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"time"</span>, <span class="st">"x_t"</span>, <span class="st">"y_t"</span>, <span class="st">"z_t"</span>)],</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"time"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">simplex_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compute_simplex.html">compute_simplex</a></span>(<span class="dt">block =</span> block,</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">                                   <span class="dt">E_list =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                                   <span class="dt">surrogate_method =</span> <span class="st">"random_shuffle"</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">                                   <span class="dt">num_surr =</span> <span class="dv">20</span>, </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">                                   <span class="dt">id_var =</span> <span class="st">"time"</span>)</a></code></pre></div>
</div>
<div id="calculations" class="section level1">
<h1 class="hasAnchor">
<a href="#calculations" class="anchor"></a>Calculations</h1>
<ol style="list-style-type: decimal">
<li>No specific plan for parallelization; calculations will be done sequentially.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># future::plan(NULL)</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">tic</a></span>()</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">ccm_results &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compute_ccm.html">compute_ccm</a></span>(simplex_results,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">                           <span class="dt">lib_sizes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                           <span class="dt">random_libs =</span> <span class="ot">TRUE</span>, <span class="dt">num_samples =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">                           <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">RNGseed =</span> <span class="dv">42</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">                           <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">toc</a></span>()</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 8.468 sec elapsed</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Same calculations as previous, but using asynchronous processes via <code>future.callr</code>.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">future<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/future/topics/plan">plan</a></span>(future.callr<span class="op">::</span>callr)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">tic</a></span>()</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">ccm_results_parallel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/compute_ccm.html">compute_ccm</a></span>(simplex_results,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                                    <span class="dt">lib_sizes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                                    <span class="dt">random_libs =</span> <span class="ot">TRUE</span>, <span class="dt">num_samples =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                                    <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">RNGseed =</span> <span class="dv">42</span>,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                                    <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">toc</a></span>()</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 8.996 sec elapsed</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Same calculations as previous, but setup within a Drake plan, and still allowing parallelization to occur within a single target.</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">my_plan &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/drake_plan">drake_plan</a></span>(<span class="dt">ccm_results_drake =</span> <span class="kw"><a href="../reference/compute_ccm.html">compute_ccm</a></span>(simplex_results,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                                                      <span class="dt">lib_sizes =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dt">by =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                                                      <span class="dt">random_libs =</span> <span class="ot">TRUE</span>, <span class="dt">num_samples =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                                                      <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">RNGseed =</span> <span class="dv">42</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                                                      <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">future<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/future/topics/plan">plan</a></span>(future.callr<span class="op">::</span>callr)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">tic</a></span>()</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/clean">clean</a></span>(<span class="dt">destroy =</span> <span class="ot">TRUE</span>, <span class="dt">force =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; Warning: Argument `force` is deprecated in small drake utility functions.</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/make">make</a></span>(my_plan)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; target ccm_results_drake</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">tictoc<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/tictoc/topics/tic">toc</a></span>()</a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; 9.205 sec elapsed</span></a></code></pre></div>
</div>
<div id="validation-of-results" class="section level1">
<h1 class="hasAnchor">
<a href="#validation-of-results" class="anchor"></a>Validation of results</h1>
<p>Check that the calculations are the same. (Note that the call to <code>compute_ccm</code> is setup to do random subsampling, but we supply a fixed seed so that the random subsamples are selected identically across runs and for each pair of variables.)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ccm_results, ccm_results_parallel)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">ccm_results_drake &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/readd">readd</a></span>(ccm_results_drake)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/identical">identical</a></span>(ccm_results, ccm_results_drake)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#setup">Setup</a></li>
      <li><a href="#calculations">Calculations</a></li>
      <li><a href="#validation-of-results">Validation of results</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hao Ye.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
