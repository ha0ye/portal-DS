---
title: "Dynamic indicators of systemic change and resilience"
author: "Hao Ye"
date: "`r Sys.Date()`"
output: bookdown::html_document2
vignette: >
  %\VignetteIndexEntry{Dynamic indicators of systemic change and resilience}
  %\VignetteEngine{knitr::rmarkdown_notangle}
  %\VignetteEncoding{UTF-8}
bibliography: my_lib.bib
---

```{r setup, include = FALSE}
LOCAL <- identical(Sys.getenv("LOCAL"), "true")
knitr::opts_chunk$set(purl = LOCAL, 
                      collapse = TRUE,
                      comment = "#>", 
                      fig.width = 6
)

library(portalDS)
```

# Abstract



# Introduction

<!-- importance of whole system change -->

Ecosystems are changing, understanding the nature of changes and their causes is important for decision-making. In other words, how likely are the observations of specific changes under different conceptual models of how ecosystems work.

Unfortunately, ecosystems are complex, with not just multiple components, but interactions among those components that produce dynamics and patterns on multiple scales. Thus, even summarizing the high-dimensional state of an ecosystem is a challenging task.

<!-- motivation for taking a dynamical view -->

Using time series is a natural way to investigate this question. Multiple values through time are required for determining baselines, and examination of the changes over time contains inherent information about what are the plausible underlying mechanisms for generating those changes.

<!-- brief review of history (re: system stability and metrics) -->

Historically, ecosystem stability has been characterized based on the interaction matrics [@May_1973a; @Pimm_1984]. We briefly summarize this approach:

1. Let the abundances of the component species in a system be $n_i$, with $i$ taking on values from $1$ to $N$, the number of species.
2. Assume that the population dynamics for each species is a function of the other species: $\displaystyle \frac{\mathrm{d} n_i}{\mathrm{d} t} = F_i \left(n_1(t), n_2(t), ..., n_N(t) \right)$
3. Let the system be in the vicinity of an equilibrium. Then the population dynamics can be linearized around this equilibrium point: $\displaystyle \frac{\mathrm{d} n_i}{\mathrm{d} t} \approx \sum_j{a_{ij} n_j(t)}$, where $a_{ij}$ are the elements of the community matrix $\mathrm{A}$.
4. The asymptotic stability of the equilibrium point is determined by the signs of the real components of the eigenvalues of the community matrix. Stability occurs when $\textrm{Re}\left(\lambda_i\right) < 0$ for all $\lambda_i$.

Stability - historically based on interactions among species 




<!-- narrow down to specific research topic (empirical measures of system change) -->
Ushio et al. [-@Ushio_2018] introduced "dynamic stability" as an empirical measure of ecosystem stability. Dynamic stability is defined as the dominant eigenvalue of the time-varying interaction matrix, and is thus a time-varying, continuous analogue to the static, binary definition of stability in Pimm [-@Pimm_1984]. At each time point, dynamic stability is a continuous quantity (with values above 1 corresponding to stable states, and values below 1 corresponding to unstable states).

$$\textrm{dynamic stability}_t = \left|\lambda_{\textrm{dom}, t}\right|$$

<!-- details of what dynamic stability and related measures are -->




<!-- summary of questions and approaches -->

```{r portal block setup, include = FALSE}
block <- make_portal_block(filter_q = 0.5)
```


(ref:portal-time-series-caption) Abundance time series of `r NCOL(block)-1` species from control plots at Portal, AZ.

```{r portal-time-series, fig.cap = '(ref:portal-time-series-caption)', echo = FALSE}
plot_time_series(block, scale = NULL)
```



# Methods
We apply dynamic stability to abundance time series from the rodent community at Portal, AZ (ref). 

## Data

Following [@Christensen_2018], we compute the site-wide abundance on the 8 control plots for the Portal data up through April 2015. (At this time a change in treatments occurred, which would decrease the number of plots with continuous observations of the control condition.) Rodent abundances are scaled to 8 plots (in some censuses, not all of the plots were sampled, e.g. due to weather).

Because EDM methods rely on extracting signal from the time series directly, we chose to pre-filter the species to those that were non-zero for at least half of the time points. This reduced the number of species from 21 to 7 (see Figure ).

## Dynamic Stability Analysis

We follow the main procedure as outlined in [@Ushio_2018]:

0. Simplex projection

1. Use convergent cross mapping [@Sugihara_2012] to construct the pairwise interaction network: i.e. test whether there is a causal effect, $n_i \rightarrow n_j \forall i,j \in \{1..N\}, i \ne j$

$A = 

2. For each time series $n_j$, fit a multivariate S-map model [@Sugihara_1994, @Deyle_2016], where causal influences identified in step 1 are included; $V_i = \{k, n_k \rightarrow n_i\}$. Here, each $n_k$ substitutes for a lag of $n_i$: i.e. the multivariate state vector for the S-map model is:

$$\mathbf{n}^\prime_i(t) = \{n_i(t), n_i(t-1), \dots, n_i(t-(E_i-1-|V_i|)\} \bigcup \{n_k(t)\}, k \in V_i$$

The multivariate state vector, $\mathbf{n}^\prime_i(t)$, is then used in the S-map model, and $\theta$ is fit via maximizing (rho?) under leave-one-out cross-validation.

3. 

## Surrogate method for convergent cross mapping

[@Ushio_2018] use a phase-lock twin surrogate method as a way to deal with seasonal signals when identifying significant causal interactions. Although the Portal rodent abundances also exhibit seasonal patterns, sampling occurs on the new moon, and thus occurs at different times of year. 



# Results



# Discussion



# Conclusions

# References